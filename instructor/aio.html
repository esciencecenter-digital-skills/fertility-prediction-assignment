<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Fertility prediction assignment: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../site.webmanifest">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><abbr class="icon" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="text-decoration: unset">
           
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #383838">Pre-Alpha
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="color: #FF4955; border-radius: 5px"></i>
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container ">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Fertility prediction assignment
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Fertility prediction assignment
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul>
</li>
      </ul>
</div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
<input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset>
</form>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Fertility prediction assignment
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
  <div id="sidebar-col" class="col-lg-4">
    <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle"><i class="search-icon" data-feather="x" role="img"></i></button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->
      
            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="fertility-prediction.html">1. Fertility prediction using LISS data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="../instructor/aio.html">See all in one page</a>

            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">
            
            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-fertility-prediction"><p>Content from <a href="fertility-prediction.html">Fertility prediction using LISS data</a></p>
<hr>
<p> Last updated on 2023-08-15 | 
        
        <a href="https://github.com/esciencecenter-digital-skills/fertility-prediction-assignment/edit/main/episodes/fertility-prediction.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 300 minutes </p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you start a real-world machine learning project?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Be able to successfully start a real-world machine learning
project.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="introducing-the-assignment"><h2 class="section-heading">Introducing the assignment<a class="anchor" aria-label="anchor" href="#introducing-the-assignment"></a>
</h2>
<hr class="half-width">
<p>In this assignment you will work individually on a machine learning
problem. The end-goal is that you are able to pick up a real-world
machine learning project.</p>
<p>This assignment will guide you through such a real-world project.</p>
<div class="section level3">
<h3 id="a-note-on-how-to-learn-the-most-from-this-assignment">A note on how to learn the most from this assignment<a class="anchor" aria-label="anchor" href="#a-note-on-how-to-learn-the-most-from-this-assignment"></a>
</h3>
<p>Some participants will learn the most from just loading in the data,
explore and build a machine learning pipeline and solve all problems you
encounter on the way yourself. Most of you will likely need the guidance
of the exercises and solutions in this assignment to bring you up to
speed. Try to take some time to solve the challenges yourself before
looking at the solutions. But if you get stuck for too long do not
hesitate to let the solutions guide you, or ask one of the trainers.</p>
<p>You will have to find a balance between guidance and self-exploration
yourself.</p>
</div>
</section><section id="introducing-the-problem"><h2 class="section-heading">1. Introducing the problem<a class="anchor" aria-label="anchor" href="#introducing-the-problem"></a>
</h2>
<hr class="half-width">
<p>The goal is to predict who will have a child in the next 3 years,
based on all the data from previous years.</p>
<p>To train your models, you will have all the background data
(features) up to 2019 and the data about the outcome - having a child in
2020-2022 (for about half of cases). So, the outcome is binary (0 - no
new children in 2020-2022, 1- at least one new child in 2020-2022). The
performance of the models will then be tested on the remaining
cases.</p>
<p>You are encouraged to use different strategies to predict the outcome
– e.g. theory-driven (to select a relatively small set of variables that
were found significant in previous studies) and data-driven
(e.g. features selected based on regularisation).</p>
<p>Features that can be used for the first simple models: gender, age,
education level, current partnership status, health, religion, fertility
intentions</p>
<div id="challenge-formulating-the-problem" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-formulating-the-problem" class="callout-inner">
<h3 class="callout-title">Challenge: Formulating the problem<a class="anchor" aria-label="anchor" href="#challenge-formulating-the-problem"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>What kind of problem is this? Classification or regression?</li>
<li>What are the inputs (features) and what are the outcomes
(target)?</li>
<li>How many classes are there in the target variable?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>This is a classification problem</li>
<li>Inputs are the background data of the persons (for example gender,
age, partnership status), outcome is who will have a child in the next 3
years.</li>
<li>There are 2 classes: not having a child in the next 3 years (0) and
having a child in the next 3 years (1). This is thus a binary
classification problem.</li>
</ol>
</div>
</div>
</div>
</div>
</section><section id="reading-in-and-exploring-the-data"><h2 class="section-heading">2. Reading in and exploring the data<a class="anchor" aria-label="anchor" href="#reading-in-and-exploring-the-data"></a>
</h2>
<hr class="half-width">
<div id="challenge-reading-in-the-data" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-reading-in-the-data" class="callout-inner">
<h3 class="callout-title">Challenge: Reading in the data<a class="anchor" aria-label="anchor" href="#challenge-reading-in-the-data"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Try to read in the data using pandas. The features are in ‘LISS
2019.csv’, the outcome variable is stored in ‘outcome.csv’/ Hint: You
might run into an encoding error. See if you can fix it by googling for
a solution.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="section level3">
<h3 id="reading-in-the-features">Reading in the features:<a class="anchor" aria-label="anchor" href="#reading-in-the-features"></a>
</h3>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This might result in UnicodeDecodeError: 'utf-8' codec can't decode byte 0x92 in position 50416: invalid start byte</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">'LISS_example_input_data.csv'</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># To tackle the encoding error:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">'LISS_example_input_data.csv'</span>, encoding<span class="op">=</span><span class="st">'cp1252'</span>)</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="reading-the-outcomes">Reading the outcomes:<a class="anchor" aria-label="anchor" href="#reading-the-outcomes"></a>
</h3>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>outcome <span class="op">=</span> pd.read_csv(<span class="st">'LISS_example_groundtruth_data.csv'</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-exploring-the-data" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-exploring-the-data" class="callout-inner">
<h3 class="callout-title">Challenge: Exploring the data<a class="anchor" aria-label="anchor" href="#challenge-exploring-the-data"></a>
</h3>
<div class="callout-content">
<p>Explore the data.</p>
<ol style="list-style-type: decimal">
<li>How many features do we have?</li>
<li>How many samples do we have?</li>
<li>Are the outcome and features datasets ordered in the same way?</li>
<li>What type of data do we have as features?</li>
<li>Is the target variable well balanced?</li>
<li>Do we have any missing data?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>Quickly explore the data:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data.shape</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(9970, 2355)</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">10</span>)</span></code></pre>
</div>
<pre class="outcome"><code>	Unnamed: 0	nomem_encr	gebjaar	geslacht	nohouse_encr2019	wave2019	positie2019	leeftijd2019	lftdcat2019	lftdhhh2019	...	cw19l600	cw19l601	cw19l602	cw19l603	cw19l604	cw19l605	cw19l606	cw19l607	cw19l608	cw19l609
0	1	800000.0	1980	Female	NaN	NaN	NaN	NaN	NaN	NaN	...	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN
1	2	800018.0	1985	Male	NaN	NaN	NaN	NaN	NaN	NaN	...	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN
2	3	800021.0	1979	Female	NaN	NaN	NaN	NaN	NaN	NaN	...	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN
3	4	800033.0	1991	Male	NaN	NaN	NaN	NaN	NaN	NaN	...	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN
4	5	800042.0	1975	Female	500277.0	201912.0	Wedded partner	44.0	35 - 44 years	47.0	...	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN
5	6	800057.0	1975	Male	580532.0	201912.0	Unwedded partner	44.0	35 - 44 years	43.0	...	80.0	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN
6	7	800076.0	1985	Female	NaN	NaN	NaN	NaN	NaN	NaN	...	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN
7	8	800085.0	1977	Male	545773.0	201912.0	Household head	42.0	35 - 44 years	42.0	...	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN
8	9	800091.0	1983	Male	515359.0	201912.0	Household head	36.0	35 - 44 years	36.0	...	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN	NaN
9	10	800100.0	1990	Female	518099.0	201912.0	Wedded partner	29.0	25 - 34 years	34.0	...	NaN	NaN</code></pre>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>outcome.head(<span class="dv">10</span>)</span></code></pre>
</div>
<pre class="outcome"><code>	nomem_encr	new_child
0	800000.0	NaN
1	800018.0	NaN
2	800021.0	NaN
3	800033.0	NaN
4	800042.0	NaN
5	800057.0	0.0
6	800076.0	NaN
7	800085.0	NaN
8	800091.0	NaN
9	800100.0	1.0</code></pre>
<ol style="list-style-type: decimal">
<li>There are 2353 features (excluding <code>nomem_encr</code> which is
just an identifier)</li>
<li>There are 9970 samples</li>
<li>Yes, looking at the first 10 rows they are ondered in the same
way.</li>
<li>The features are both categorical and numerical</li>
</ol>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>outcome[<span class="st">'new_child'</span>].describe()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>count    1292.000000
mean        0.164087
std         0.370498
min         0.000000
25%         0.000000
50%         0.000000
75%         0.000000
max         1.000000
Name: new_child, dtype: float64</code></pre>
</div>
<ol start="5" style="list-style-type: decimal">
<li>The target variable is pretty unbalanced, only 16.4 % of the samples
are in the <code>1</code> class</li>
<li>There are a lot of missing data in both the features and the
outcome.</li>
</ol>
</div>
</div>
</div>
</div>
</section><section id="taking-a-step-back"><h2 class="section-heading">3. Taking a step back<a class="anchor" aria-label="anchor" href="#taking-a-step-back"></a>
</h2>
<hr class="half-width">
<p>Before you start enthusiastically typing all kinds of pandas and
sklearn commands that you just learned. Now that you have explored the
data, it is good to take a step back and think about how you want to
approach the problem.</p>
<div id="challenge-what-steps-to-take-next" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-what-steps-to-take-next" class="callout-inner">
<h3 class="callout-title">Challenge: What steps to take next?<a class="anchor" aria-label="anchor" href="#challenge-what-steps-to-take-next"></a>
</h3>
<div class="callout-content">
<p>Now that you know the data a little bit. What are the steps that you
need to take before we can train our first modeling pipeline. Think
about the essential steps that will get you a working pipeline. Take
shortcuts where possible. It does not need to be a very accurate
predictor (yet ;) ). Also think about the order in which to do
things.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>These are the minimum steps that need to happen, in this order:</p>
<ol style="list-style-type: decimal">
<li>Select features</li>
<li>Deal with missing data. The quickest way is to just drop all rows
that have any missing value.</li>
<li>Preprocess the features: scaling for numerical values, one-hot
encoding for categorical values.</li>
<li>Split the data in a train and test set.</li>
<li>Train the model and evaluate!</li>
</ol>
<p>We will not worry about the unbalanced target yet. Let’s first see
how a model performs on the unbalanced dataset.</p>
</div>
</div>
</div>
</div>
</section><section id="prepare-the-data"><h2 class="section-heading">4. Prepare the data<a class="anchor" aria-label="anchor" href="#prepare-the-data"></a>
</h2>
<hr class="half-width">
<div id="challenge-selecting-data-for-a-quick-and-dirty-first-model" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-selecting-data-for-a-quick-and-dirty-first-model" class="callout-inner">
<h3 class="callout-title">Challenge: Selecting data for a quick and
dirty first model<a class="anchor" aria-label="anchor" href="#challenge-selecting-data-for-a-quick-and-dirty-first-model"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Take max 5 minutes to have a look at the codebook. Quickly pick 5
variables that you think will have some explanatory value for predicting
fertility.</li>
<li>Use <code>pandas</code> to keep only these columns in your
dataset</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>There is no right or wrong here.</p>
<p>A good set to start with would be to pick 5 variables from 2019. The
most recent year has probably the most explanatory value. Based on
gut-feeling we selected these 5 variables:</p>
<ul>
<li>burgstat2019</li>
<li>leeftijd2019</li>
<li>woonvorm2019</li>
<li>oplmet2019</li>
<li>aantalki2019</li>
</ul>
<p>What matters is that you for the first cycle, just quickly pick the
most promising variables.</p>
<p>You can easily spend hours deciding which variables to pick, but it
is important to have your first pipeline as soon as possible and start
iterating from there. This is maybe something you are not used to in
research!</p>
<div class="section level4">
<h4 id="select-the-data">2. Select the data<a class="anchor" aria-label="anchor" href="#select-the-data"></a>
</h4>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>selected_columns <span class="op">=</span> [<span class="st">'burgstat2019'</span>, <span class="st">'leeftijd2019'</span>, <span class="st">'woonvorm2019'</span>, <span class="st">'oplmet2019'</span>, <span class="st">'aantalki2019'</span>]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> data[selected_columns]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="dealing-with-missing-values">Dealing with missing values<a class="anchor" aria-label="anchor" href="#dealing-with-missing-values"></a>
</h3>
<p>There are many ways to deal with missing data. The quick and dirty
way is to just get rid of all rows that contain any missing value.</p>
<div id="challenge-remove-missing-values" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-remove-missing-values" class="callout-inner">
<h3 class="callout-title">Challenge: Remove missing values<a class="anchor" aria-label="anchor" href="#challenge-remove-missing-values"></a>
</h3>
<div class="callout-content">
<p>Remove all samples in both the features and target that have any
missing value. NB: so if the target value is null or any of the features
is null we drop the entire sample.</p>
<p>Hint: You need to find a clever way to delete the samples in both the
target and feature datasets.</p>
<p>How many samples do we have left?</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The null values in the target variable</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>y_isna <span class="op">=</span> outcome[<span class="st">'new_child'</span>].isnull()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The rows where any of the features is NaN</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>X_isna <span class="op">=</span> features.isnull().<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># For both datasets drop rows where any of the features is NaN OR the outcome is NaN</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> features.drop(features[y_isna <span class="op">|</span> X_isna].index)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>outcome <span class="op">=</span> outcome.drop(outcome[y_isna <span class="op">|</span> X_isna].index)</span></code></pre>
</div>
<p>You could also first <code>join</code> the two datasets, drop any row
with missing value, then split the datasets again.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>features.shape</span></code></pre>
</div>
<pre class="outcome"><code>(1292, 5)</code></pre>
<p>There are 1292 samples left.</p>
</div>
</div>
</div>
</div>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>Remember that the benchmark dataset that is used to test your
submissions will also have missing values. The quick and dirty solution
that we are starting with will thus not be able to make predictions for
the samples in the benchmark dataset that have missing values in the
features that you picked!</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="preprocess-the-data">Preprocess the data<a class="anchor" aria-label="anchor" href="#preprocess-the-data"></a>
</h3>
<div id="challenge-preprocess-the-data" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-preprocess-the-data" class="callout-inner">
<h3 class="callout-title">Challenge: Preprocess the data<a class="anchor" aria-label="anchor" href="#challenge-preprocess-the-data"></a>
</h3>
<div class="callout-content">
<p>Create a preprocessor to process the features. (hint: use the
<code>ColumnTransformer</code> class that we introduced before) to
preprocess the data Use a standard scaler for numerical values, one-hot
encoding for categorical values.</p>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" data-bs-parent="#accordionSolution7" aria-labelledby="headingSolution7">
<div class="accordion-body">
<p>Select the numerical and categorical columns automatically:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_selector <span class="im">as</span> selector</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>numerical_columns_selector <span class="op">=</span> selector(dtype_exclude<span class="op">=</span><span class="bu">object</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>categorical_columns_selector <span class="op">=</span> selector(dtype_include<span class="op">=</span><span class="bu">object</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>numerical_columns <span class="op">=</span> numerical_columns_selector(features)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>categorical_columns <span class="op">=</span> categorical_columns_selector(features)</span></code></pre>
</div>
<p>Define a preprocessor:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder, StandardScaler</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>categorical_preprocessor <span class="op">=</span> OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">"ignore"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>numerical_preprocessor <span class="op">=</span> StandardScaler()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer([</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'one-hot-encoder'</span>, categorical_preprocessor, categorical_columns),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'standard_scaler'</span>, numerical_preprocessor, numerical_columns)])</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="separate-data-in-train-and-test">Separate data in train and test<a class="anchor" aria-label="anchor" href="#separate-data-in-train-and-test"></a>
</h3>
<div id="separate-the-data-in-a-train-and-test-set" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="separate-the-data-in-a-train-and-test-set" class="callout-inner">
<h3 class="callout-title">Separate the data in a train and test set<a class="anchor" aria-label="anchor" href="#separate-the-data-in-a-train-and-test-set"></a>
</h3>
<div class="callout-content">
<p>Separate the data in a train and test set, the test set should have
30% of the samples.</p>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" data-bs-parent="#accordionSolution8" aria-labelledby="headingSolution8">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    features, outcome[<span class="st">'new_child'</span>], test_size<span class="op">=</span><span class="fl">0.30</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="train-a-model"><h2 class="section-heading">5. Train a model<a class="anchor" aria-label="anchor" href="#train-a-model"></a>
</h2>
<hr class="half-width">
<div id="challenge-train-the-model" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-train-the-model" class="callout-inner">
<h3 class="callout-title">Challenge: Train the model<a class="anchor" aria-label="anchor" href="#challenge-train-the-model"></a>
</h3>
<div class="callout-content">
<p>Create a pipeline that pipes our preprocessor and a
<code>LogisticRegression</code> model. Fit the pipeline to the data.</p>
</div>
</div>
</div>
<div id="accordionSolution9" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution9" aria-expanded="false" aria-controls="collapseSolution9">
  <h4 class="accordion-header" id="headingSolution9">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution9" class="accordion-collapse collapse" data-bs-parent="#accordionSolution9" aria-labelledby="headingSolution9">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_pipeline(preprocessor, LogisticRegression(max_iter<span class="op">=</span><span class="dv">500</span>))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>model</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('one-hot-encoder',
                                                  OneHotEncoder(handle_unknown='ignore'),
                                                  ['burgstat2019',
                                                   'woonvorm2019', 'oplmet2019',
                                                   'aantalki2019']),
                                                 ('standard_scaler',
                                                  StandardScaler(),
                                                  ['leeftijd2019'])])),
                ('logisticregression', LogisticRegression(max_iter=500))])</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> model.fit(X_train, y_train)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="evaluate-the-model"><h2 class="section-heading">6. Evaluate the model<a class="anchor" aria-label="anchor" href="#evaluate-the-model"></a>
</h2>
<hr class="half-width">
<div id="challenge-evaluate-the-model" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-evaluate-the-model" class="callout-inner">
<h3 class="callout-title">Challenge: Evaluate the model<a class="anchor" aria-label="anchor" href="#challenge-evaluate-the-model"></a>
</h3>
<div class="callout-content">
<p>Let’s evaluate our first model.</p>
<ol style="list-style-type: decimal">
<li>Visualize the performance of the model.</li>
<li>What do you think of the results? Why do you think the results are
like this?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution10" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution10" aria-expanded="false" aria-controls="collapseSolution10">
  <h4 class="accordion-header" id="headingSolution10">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution10" class="accordion-collapse collapse" data-bs-parent="#accordionSolution10" aria-labelledby="headingSolution10">
<div class="accordion-body">
<p>You can best visualize the results using a confusion matrix:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> ConfusionMatrixDisplay</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ConfusionMatrixDisplay.from_estimator(model, X_test, y_test)</span></code></pre>
</div>
<figure><img src="../fig/confusion-matrix-1.png" class="figure mx-auto d-block"></figure><p>As you can see the model almost always predicts the majority class (0
- no kids). Because 84% of the data falls within this class, this is
actually not a bad strategy. It leads to an accuracy of 84%!</p>
<p>Of course this is not what we want, we also want to model to make
correct predictions for the minority class.</p>
<p>We thus have to deal with imbalanced data!</p>
</div>
</div>
</div>
</div>
</section><section id="dealing-with-imbalanced-data"><h2 class="section-heading">7. Dealing with imbalanced data<a class="anchor" aria-label="anchor" href="#dealing-with-imbalanced-data"></a>
</h2>
<hr class="half-width">
<div id="challenge-how-do-deal-with-unbalanced-ata" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-how-do-deal-with-unbalanced-ata" class="callout-inner">
<h3 class="callout-title">Challenge: How do deal with unbalanced
ata?<a class="anchor" aria-label="anchor" href="#challenge-how-do-deal-with-unbalanced-ata"></a>
</h3>
<div class="callout-content">
<p>What do you think is a good way to deal with the unbalance in the
target variable?</p>
</div>
</div>
</div>
<div id="accordionSolution11" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution11" aria-expanded="false" aria-controls="collapseSolution11">
  <h4 class="accordion-header" id="headingSolution11">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution11" class="accordion-collapse collapse" data-bs-parent="#accordionSolution11" aria-labelledby="headingSolution11">
<div class="accordion-body">
<p>There are multiple ways to deal with this:</p>
<ol style="list-style-type: decimal">
<li>Find a model that can handle unbalanced data better</li>
<li>Upsample the data (duplicate a proportion of the minority class
samples)</li>
<li>Downsample the data (take a subset of the majority class
samples)</li>
</ol>
</div>
</div>
</div>
</div>
<div id="challenge-balance-the-dataset" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-balance-the-dataset" class="callout-inner">
<h3 class="callout-title">Challenge: Balance the dataset<a class="anchor" aria-label="anchor" href="#challenge-balance-the-dataset"></a>
</h3>
<div class="callout-content">
<p>Go ahead and balance the training dataset using the upsampling
strategy. Hint: Try googling first, but you can have a look at: <a href="https://vitalflux.com/handling-class-imbalance-sklearn-resample-python/" class="external-link uri">https://vitalflux.com/handling-class-imbalance-sklearn-resample-python/</a></p>
</div>
</div>
</div>
<div id="accordionSolution12" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution12" aria-expanded="false" aria-controls="collapseSolution12">
  <h4 class="accordion-header" id="headingSolution12">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution12" class="accordion-collapse collapse" data-bs-parent="#accordionSolution12" aria-labelledby="headingSolution12">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.utils <span class="im">import</span> resample</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create oversampled training data set for minority class</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>X_oversampled, y_oversampled <span class="op">=</span> resample(X_train[y_train <span class="op">==</span> <span class="dv">1</span>],</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                                        y_train[y_train <span class="op">==</span> <span class="dv">1</span>],</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                                        replace<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                                        n_samples<span class="op">=</span>X_train[y_train <span class="op">==</span> <span class="dv">0</span>].shape[<span class="dv">0</span>],</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                                        random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Append the oversampled minority class to training data and related labels</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>X_balanced <span class="op">=</span> pd.concat((X_train[y_train <span class="op">==</span> <span class="dv">0</span>], X_oversampled))</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>y_balanced <span class="op">=</span> pd.concat((y_train[y_train <span class="op">==</span> <span class="dv">0</span>], y_oversampled))</span></code></pre>
</div>
<p>Check that the data is indeed balanced:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>y_balanced.mean()</span></code></pre>
</div>
<pre class="outcome"><code><span><span class="fl">0.5</span></span></code></pre>
<p>Check that there is now indeed more in the training set:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>X_balanced.shape</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(1506, 5)</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="train-and-evaluate-the-model-trained-on-a-balanced-dataset"><h2 class="section-heading">8. Train and evaluate the model trained on a balanced dataset<a class="anchor" aria-label="anchor" href="#train-and-evaluate-the-model-trained-on-a-balanced-dataset"></a>
</h2>
<hr class="half-width">
<p>Now that we have balanced our dataset, we can see whether this
improves the performance of our model!</p>
<div id="challenge-train-the-model-on-the-balanced-dataset" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-train-the-model-on-the-balanced-dataset" class="callout-inner">
<h3 class="callout-title">Challenge: Train the model on the balanced
dataset<a class="anchor" aria-label="anchor" href="#challenge-train-the-model-on-the-balanced-dataset"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Train the model on the balanced dataset</li>
<li>Evaluate the model by visualizing the results. What do you see?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution13" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution13" aria-expanded="false" aria-controls="collapseSolution13">
  <h4 class="accordion-header" id="headingSolution13">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution13" class="accordion-collapse collapse" data-bs-parent="#accordionSolution13" aria-labelledby="headingSolution13">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> model.fit(X_balanced, y_balanced)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ConfusionMatrixDisplay.from_estimator(model, X_test, y_test)</span></code></pre>
</div>
<figure><img src="../fig/confusion-matrix-2.png" class="figure mx-auto d-block"></figure><p>This already looks much better! The predictions are more balanced
over the two classes, and are also quite often correct. So balancing the
data helped a lot!</p>
</div>
</div>
</div>
</div>
</section><section id="use-evaluation-metrics-to-evaluate-the-model"><h2 class="section-heading">9. Use evaluation metrics to evaluate the model<a class="anchor" aria-label="anchor" href="#use-evaluation-metrics-to-evaluate-the-model"></a>
</h2>
<hr class="half-width">
<p>So far we have used a confusion matrix to visually evaluate the
model. When proceeding it would be better to use evaluation metrics for
this.</p>
<div id="challenge-evaluation-metrics" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge-evaluation-metrics" class="callout-inner">
<h3 class="callout-title">Challenge: Evaluation metrics<a class="anchor" aria-label="anchor" href="#challenge-evaluation-metrics"></a>
</h3>
<div class="callout-content">
<p>Evaluate the model using the appropriate evaluation metrics. Hint:
the dataset is unbalanced. :::: solution</p>
<div class="section level2">
<h2 id="solution-11">Solution<a class="anchor" aria-label="anchor" href="#solution-11"></a>
</h2>
<p>Good evaluation metrics would be precision, recall, and F1-score for
the positive class (getting a child in the next 3 years) This of course
also makes sense, sense these are the metrics that are used in the
benchmark.</p>
<p>Precision gives us a measure for how many of the households labeled
as ‘fertile’ was that a correct prediction. Recall gives us a measure
for how many of the households that are actually ‘fertile’ how many we
correctly ‘detect’ as being fertile.</p>
<p>F1-score is the harmonic mean of the two.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>p, r, f, _ <span class="op">=</span> precision_recall_fscore_support(y_test, y_pred, average<span class="op">=</span><span class="st">'binary'</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Precision: </span><span class="sc">{</span>p<span class="sc">}</span><span class="ss">, recall: </span><span class="sc">{</span>r<span class="sc">}</span><span class="ss">, F1-score: </span><span class="sc">{</span>f<span class="sc">}</span><span class="ss">'</span>)</span></code></pre>
</div>
<pre class="outcome"><code>Precision: 0.23387096774193547, recall: 0.6590909090909091, F1-score: 0.3452380952380952</code></pre>
<p>Challenge: Test your understanding of precision and recall by
computing the scores by hand! You can use the numbers shown in the
confusion matrix for this.</p>
</div>
</div>
</div>
</div>
<p>:::</p>
</section><section id="adapt-train-evaluate.-adapt-train-evaluate."><h2 class="section-heading">10. Adapt, train, evaluate. Adapt, train, evaluate.<a class="anchor" aria-label="anchor" href="#adapt-train-evaluate.-adapt-train-evaluate."></a>
</h2>
<hr class="half-width">
<p>Good job! You have now set up a simple, yet effective machine
learning pipeline on a real-world problem. Notice that you already went
through the machine learning cycle twice. From this point onward it is a
matter of adapting your approach, train the model, evaluate the results.
Again, and again, and again.</p>
<p>Of course there is still a lot of room for improvement. Every time
you evaluate the results, try to come up with a shortlist of things that
seem most promising to try out in the next cycle.</p>
<div id="challenge-improving-the-model-further" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-improving-the-model-further" class="callout-inner">
<h3 class="callout-title">Challenge: Improving the model further<a class="anchor" aria-label="anchor" href="#challenge-improving-the-model-further"></a>
</h3>
<div class="callout-content">
<p>What ideas do you have to improve the model further?</p>
</div>
</div>
</div>
<div id="accordionSolution14" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution14" aria-expanded="false" aria-controls="collapseSolution14">
  <h4 class="accordion-header" id="headingSolution14">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution14" class="accordion-collapse collapse" data-bs-parent="#accordionSolution14" aria-labelledby="headingSolution14">
<div class="accordion-body">
<p>There is no right or wrong, but here are some pointers:</p>
<ul>
<li>Include more features. You can think of automated feature selection
to select features or go through the codebook by hand and select the
most promising.</li>
<li>Engineer more features. You could try and create new features
yourself, based on the variables in the dataset, or maybe combine a
different dataset.</li>
<li>Try out different models.</li>
<li>Come up with a good baseline, to get a feeling for how good the
model is performing.</li>
<li>Use hyperparameter tuning to find the best hyperparameters for a
model.</li>
<li>Try out different preprocessing approaches</li>
<li>Deal with missing data differently. Try out imputation.</li>
</ul>
</div>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/esciencecenter-digital-skills/fertility-prediction-assignment/edit/main/README.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/esciencecenter-digital-skills/fertility-prediction-assignment/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/esciencecenter-digital-skills/fertility-prediction-assignment/" class="external-link">Source</a></p>
				<p><a href="https://github.com/esciencecenter-digital-skills/fertility-prediction-assignment/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:s.vanderburg@esciencecenter.nl">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="../LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper" class="external-link">sandpaper (0.12.5)</a>,
        <a href="https://github.com/carpentries/pegboard" class="external-link">pegboard (0.6.0)</a>,
      and <a href="https://github.com/carpentries/varnish/tree/0.2.18" class="external-link">varnish (0.2.18)</a>.</p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://esciencecenter-digital-skills.github.io/fertility-prediction-assignment/instructor/aio.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://esciencecenter-digital-skills.github.io/fertility-prediction-assignment/instructor/aio.html",
  "identifier": "https://esciencecenter-digital-skills.github.io/fertility-prediction-assignment/instructor/aio.html",
  "dateCreated": "2023-06-21",
  "dateModified": "2023-08-29",
  "datePublished": "2023-08-29"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

